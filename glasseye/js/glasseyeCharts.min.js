var GlasseyeChart=function(t,a,e,r){var n=this;n.div=t,n.size=a,n.margin=e,n.custom_height=r,n.set_size()};function highlight(t){return"<span class = 'highlighted'>"+t+"</span>"}function max_string_length(t){t=t.map(function(t){return t.length});return Math.max.apply(null,t)}GlasseyeChart.prototype.set_size=function(){var t=this,a=d3.select(t.div).node().getBoundingClientRect();return void 0===t.margin&&(t.margin={top:20,bottom:20,right:20,left:20}),"full_page"===t.size?(t.svg_width=a.width<500&0<a.width?a.width:500,t.svg_height=void 0===t.custom_height?300:t.custom_height):"margin"===t.size?(t.svg_width=300,t.svg_height=void 0===t.custom_height?250:t.custom_height):("double_plot_wide"===t.size?t.svg_width=a.width<600?a.width:600:"double_plot_narrow"===t.size?t.svg_width=a.width<300?a.width:300:t.svg_width=300,t.svg_height=void 0===t.custom_height?360:t.custom_height),t.width=t.svg_width-t.margin.left-t.margin.right,t.height=t.svg_height-t.margin.top-t.margin.bottom,t},GlasseyeChart.prototype.add_svg=function(){var t=this;return t.svg=d3.select(t.div).append("svg").attr("class","glasseye_chart").attr("width",t.svg_width).attr("height",t.svg_height),t.chart_area=t.svg.append("g").attr("class","chart_area").attr("transform","translate("+t.margin.left+","+t.margin.top+")"),t},GlasseyeChart.prototype.add_title=function(t,a){var e=this;return e.title=t,e.svg.append("text").attr("class","title").text(t).attr("transform","translate("+e.margin.left+",20)"),null!=a&&(e.subtitle=a,e.svg.append("text").attr("class","subtitle").text(a).attr("transform","translate("+e.margin.left+",35)")),e},GlasseyeChart.prototype.set_tooltip_text=function(e,r,n){var i=this;return i.tooltip_text=function(a){var t=r.map(function(t){return"filter"===t?i.current_variable:a[t]});return create_commentary(e,t,n)},i.tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(i.tooltip_text),i};var uni_format=function(t){t=(999<t?d3.format(".3s"):100<t?d3.format(".3r"):10<=t&&Math.round(t)===t?d3.format(".0f"):d3.format(".1f"))(t);return t},uni_format_range=function(t){var a=t[0],t=t[1];return console.log(a),console.log(t),d3.format(",.0f")},uni_format_axis=function(t){t=(1<=t?d3.format("s"):d3.format(""))(t);return t},format_millions=function(t){return Math.round(t/1e3)+"m"},format_millions_2d=function(t){return d3.format(".3r")(t/1e3)+"m"},quarter_year=function(t){var a=d3.time.format("%m")(t),t=d3.time.format("%Y")(t);return"Q"+parseInt(a)/3+" "+t};function cap_first_letter(t){return t.charAt(0).toUpperCase()+t.slice(1)}function lower_case(t){return t.toLowerCase()}function unchanged(t){return t}function create_commentary(t,a,r){var n=t.split("$"),i="";return a.forEach(function(t,a){var e=void 0===r?uni_format:r[a];i=i+n[a]+e(t)}),i}function create_scale(t,a,e){var r=d3.min(t),n=d3.max(t),i=n-r,s=i/n,o=a;return a="function"==typeof a.rangePoints?(o.domain(t),"ordinal"):"number"==typeof t[0]?((s<.25||r<0?o.domain([r-.1*i,n+.1*i]):o.domain([0,n+.1*i])).nice,"linear"):(o.domain([r,n]).nice,"Date"===t[0].constructor.name?"datetime":"nonlinear"),{scale_func:o,scale_type:a}}function build_chart(t,e,r,n,i,a,s){"object"==typeof t?(a=a(t),s(a,e,r,n)):d3.csv(t,function(t,a){a=i(a);s(a,e,r,n)})}function add_legend(t,a,e,r){t=t.selectAll(".legend_item").data(r).enter().append("g").attr("class","legend_item").attr("transform","translate("+a+","+e+")");t.append("rect").attr("width",10).attr("height",10).attr("class",function(t){return"legend_block "+t.class}).attr("x",10).attr("y",function(t,a){return 20*a}).attr("fill",function(t,a){return t.colour}),t.append("text").attr("x",27).attr("y",function(t,a){return 8+20*a}).text(function(t){return t.label})}function wrap(t,l){t.each(function(){for(var t,a=d3.select(this),e=a.text().split(/\s+/).reverse(),r=[],n=0,i=a.attr("y"),s=parseFloat(a.attr("dy")),o=a.text(null).append("tspan").attr("x",0).attr("y",i).attr("dy",s+"em");t=e.pop();)r.push(t),o.text(r.join(" ")),o.node().getComputedTextLength()>l&&(r.pop(),o.text(r.join(" ")),r=[t],o=a.append("tspan").attr("x",0).attr("y",i).attr("dy",1.1*++n+s+"em").text(t))})}function abbrev(t,a){return t=t.length>a?t.substring(0,a-3)+"...":t}function minmax_across_groups(t,a){return y_values=t.map(function(t){return t.values.map(function(t){if(t.variable===a)return t.value})}),y_values=[].concat.apply([],y_values),[d3.min(y_values),d3.max(y_values)]}function create_class_label(t,a){return t+"_"+a.replace(/[.,\/#!$%\^&\*;:{}=+\-_`~()]/g,"").replace(" ","")}var GridChart=function(t,a,e,r,n,i){var s=this;s.scales=r,s.labels=e,GlasseyeChart.call(s,t,a,n,i),"ordinal"===r[0].scale_type?s.x=s.scales[0].scale_func.rangePoints([0,s.width],1):s.x=s.scales[0].scale_func.range([0,s.width]),"ordinal"===r[1].scale_type?s.y=s.scales[1].scale_func.rangePoints([s.height,0],1):s.y=s.scales[1].scale_func.range([s.height,0]),s.x_axis=d3.svg.axis().scale(s.x).orient("bottom").tickSize(-s.height,0,0).tickPadding(10),s.y_axis=d3.svg.axis().scale(s.y).orient("left").tickSize(-s.width,0,0),"ordinal"!=r[1].scale_type&&s.y_axis.tickFormat(uni_format_axis),s.tooltip_formtter=uni_format};function treemap(u,t,a){build_chart(u,t,a,void 0,function(t){},function(t){return t},function(t,a,e){var r,n=d3.scale.linear().range([0,300]),i=d3.scale.linear().range([0,400]),s=d3.scale.category20c(),o=d3.layout.treemap().round(!1).size([300,400]).sticky(!0).value(function(t){return t.size}),l=d3.select(a).append("svg:svg").attr("width",300).attr("height",400).append("svg:g").attr("transform","translate(.5,.5)"),c=r=u,a=o.nodes(r).filter(function(t){return!t.children}),a=l.selectAll("g").data(a).enter().append("svg:g").attr("class","cell").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).on("click",function(t){return h(c==t.parent?r:t.parent)});function e(t){return t.size}function d(t){return 1}function h(t){var a=300/t.dx,e=400/t.dy,r=(n.domain([t.x,t.x+t.dx]),i.domain([t.y,t.y+t.dy]),l.selectAll("g.cell").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+n(t.x)+","+i(t.y)+")"}));r.select("rect").attr("width",function(t){return a*t.dx-1}).attr("height",function(t){return e*t.dy-1}),r.select("text").attr("x",function(t){return a*t.dx/2}).attr("y",function(t){return e*t.dy/2}),c=t,d3.event.stopPropagation()}a.append("svg:rect").attr("width",function(t){return t.dx-1}).attr("height",function(t){return t.dy-1}).style("fill",function(t){return s(t.parent.name)}),a.append("svg:text").attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}),d3.select(window).on("click",function(){h(r)}),d3.select("select").on("change",function(){o.value("size"==this.value?e:d).nodes(r),h(c)})})}function simplot(t,a,e){build_chart(t,a,e,void 0,function(t){var a=[],r=(t.map(function(t){-1===a.indexOf(t.variation)&&a.push(t.variation)}),[]),e=(t.map(function(t){-1===r.indexOf(t.sim_num)&&r.push(t.sim_num)}),a.map(function(e){return{variation:e,simulations:r.map(function(a){return{simulation:+a,values:t.filter(function(t){return t.variation===e&&t.sim_num===a}).map(function(t){return{value:+t.value,iter:+t.day}})}})}}));return{original_data:t,grouped_data:e,variations:a,simulations:r}},function(t){},function(r,t,a){var t=new GlasseyeChart(t,a,{top:20,bottom:20,right:100,left:20}),n=(t.add_svg(),d3.scale.category20()),e=d3.scale.linear().range([0,t.width]).domain([d3.min(r.original_data,function(t){return+t.day})-10,d3.max(r.original_data,function(t){return+t.day})]),i=d3.scale.linear().range([t.height,0]).domain([d3.min(r.original_data,function(t){return+t.value}),d3.max(r.original_data,function(t){return+t.value})]),a=d3.svg.axis().scale(e).orient("bottom").tickSize(-t.height,0,0),s=d3.svg.axis().scale(i).tickSize(-t.width,0,0).orient("left"),o=t.chart_area,l=(o.append("g").attr("class","chart_grid").attr("transform","translate(0,"+t.height+")").call(a),o.append("g").attr("class","chart_grid").call(s),d3.svg.line().interpolate("linear").x(function(t){return e(t.iter)}).y(function(t){return i(t.value)}));r.grouped_data.forEach(function(a,e){o.selectAll(".variations").data(a.simulations).enter().append("g").append("path").attr("class","line").attr("d",function(t){return l(t.values)}).style("stroke",function(t){return n(a.variation)}).attr("opacity",function(t){return-1===t.simulation?1:.1}).each(function(t){t.totalLength=this.getTotalLength()}).attr("stroke-dasharray",function(t){return t.totalLength+" "+t.totalLength}).attr("stroke-dashoffset",function(t){return t.totalLength}).transition().delay(7e3*e).duration(7e3).ease("linear").attr("stroke-dashoffset",0).transition().duration(7e3*(r.variations.length-1-e)).attr("stroke-dashoffset",0).each("end",function t(){var a=d3.select(this);a.attr("stroke-dasharray",function(t){return t.totalLength+" "+t.totalLength}).attr("stroke-dashoffset",function(t){return t.totalLength}).transition().delay(7e3*e).duration(7e3).ease("linear").attr("stroke-dashoffset",0).transition().duration(7e3*(r.variations.length-1-e)).attr("stroke-dashoffset",0).each("end",t)})}),1<r.variations.length&&add_legend(o,t.width+t.margin.left,t.margin.top,r.variations.map(function(t){return{label:t,colour:n(t)}}))})}function dot_plot(t,p,a){var f=20,g=30,m=650-g-250,_=400-f-110,y=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t.value});d3.csv(t,function(t,e){var r=d3.scale.category10(),a=[],n=(e.map(function(t){-1===a.indexOf(t.group)&&a.push(t.group)}),[]),i=(e.map(function(t){-1===n.indexOf(t.variable)&&n.push(t.variable)}),a.map(function(a){return{group:a,values:e.filter(function(t){return t.group===a}).map(function(t){return{value:+t.value,variable:t.variable}})}})),s=d3.min(e,function(t){return+t.value}),o=d3.max(e,function(t){return+t.value}),l=o-s,c=l/o,d=d3.scale.linear().range([_,0]),h=((c<.3?d.domain([s-.1*l,o+.1*l]):d.domain([0,o])).nice,d3.scale.ordinal().rangePoints([0,m],1).domain(n)),c=d3.svg.axis().scale(h).orient("bottom").tickSize(-_,0,0).tickFormat(function(t){return 15<t.length?t.substring(0,15)+"..":t}),s=d3.svg.axis().scale(d).tickSize(-m,0,0).orient("left"),u=d3.select(p).append("svg").attr("width",650).attr("height",400).append("g").attr("transform","translate("+g+","+f+")");u.call(y),u.append("g").attr("class","chart_grid").attr("transform","translate(0,"+_+")").call(c).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-90)"),u.append("g").attr("class","chart_grid").call(s),i.forEach(function(a,t){u.selectAll(".dot").data(a.values).enter().append("circle").attr("cx",function(t){return h(t.variable)}).attr("cy",function(t){return d(t.value)}).attr("r",6).attr("fill",function(t){return r(a.group)}).attr("opacity",.5).on("mouseover",y.show).on("mouseout",y.hide)}),1<a.length&&add_legend(u,m+g,f,a.map(function(t){return{label:t,colour:r(t)}}))})}GridChart.prototype=Object.create(GlasseyeChart.prototype),GridChart.prototype.set_y_axis_format=function(t){return this.y_axis.tickFormat(t),this.tooltip_formtter=t,this},GridChart.prototype.add_grid=function(){var t=this,a=t.chart_area.append("g").attr("class","chart_grid x_axis").attr("transform","translate(0,"+t.height+")").call(t.x_axis);return"nonlinear"===t.scales[0].scale_type&&a.selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-90)"),t.chart_area.append("g").attr("class","chart_grid y_axis").call(t.y_axis),void 0!==t.labels&&(t.svg.append("g").attr("class","axis_label axis_label_x").attr("transform","translate("+(t.margin.left+t.width+15)+", "+(t.height+t.margin.top)+") rotate(-90)").append("text").text(t.labels[0]),t.svg.append("g").attr("class","axis_label axis_label_y").attr("transform","translate("+t.margin.left+", "+(t.margin.top-8)+")").append("text").text(t.labels[1])),t};var Tree=function(t,a,e){this.margin="full_page"===e?{top:5,bottom:5,left:100,right:100}:{top:5,bottom:5,left:50,right:50},GlasseyeChart.call(this,a,e,this.margin,300),this.processed_data=t};function tree(t,a,e){build_chart(t,a,e,void 0,function(t){return t},function(t){return t},function(t,a,e){new Tree(t,a,e).add_svg().add_tree()})}Tree.prototype=Object.create(GlasseyeChart.prototype),Tree.prototype.add_tree=function(){var t=d3.hierarchy(this.processed_data),t=d3.tree().size([this.height-this.margin.top-this.margin.bottom,this.width-this.margin.left-this.margin.right])(t),a=t.descendants(),t=t.links(),t=(this.chart_area.selectAll(".link").data(t).enter().append("path").attr("class","link").attr("d",d3.linkHorizontal().x(t=>t.y).y(t=>t.x)),this.chart_area.selectAll(".node").data(a).enter().append("g").attr("class","node").attr("transform",t=>`translate(${t.y},${t.x})`));t.append("circle").attr("r",5),t.append("text").attr("dy",3).attr("x",t=>t.children?-10:10).style("text-anchor",t=>t.children?"end":"start").text(t=>t.data.name)};var Venn=function(t,a,e){margin={top:5,bottom:5,left:5,right:5},GlasseyeChart.call(this,a,e,margin),this.processed_data=t,this.venn_chart=venn.VennDiagram().width(500).height(400)};function vennchart(t,a,e){build_chart(t,a,e,void 0,function(t){return t},function(t){return t},function(t,a,e){new Venn(t,a,e).add_svg().add_venn()})}Venn.prototype=Object.create(GlasseyeChart.prototype),Venn.prototype.add_venn=function(){this.chart_area.datum(this.processed_data).call(this.venn_chart),this.chart_area.selectAll(".venn-circle path").style("fill-opacity",.5),this.chart_area.selectAll(".venn-circle text").style("font-size","14px").style("fill","#000")};var Dial=function(t,a,e,r){this.processed_data=t;GlasseyeChart.call(this,a,e),r[0].scale_func.domain();this.dial_radius=.55*this.width/2,this.dial_scale=r[0].scale_func.range([0,359]),this.dial_scale.domain([-.3,.1]).clamp(!0),this.current_angle=this.dial_scale(-.123);var t=d3.range(0,360,30),n=this.dial_scale;this.dial_face_data=t.map(function(t){return{angle:t,value:n.invert((t+180)%360)}})},LogisticCurve=(Dial.prototype=Object.create(GlasseyeChart.prototype),Dial.prototype.add_dial=function(){var e=this,t=e.chart_area.append("g").attr("transform","translate("+e.width/2+", "+e.height/2.5+")");t.append("svg").attr("width",e.dial_radius).attr("height",e.dial_radius).append("circle").attr("r",e.dial_radius).style("fill","#990000"),t.append("circle").attr("class","dial_face").attr("r",e.dial_radius),t.append("circle").attr("class","dial_seg").attr("r",.4*e.dial_radius).attr("fill","black"),t.append("circle").attr("class","dial_centre").attr("r",.05*e.dial_radius),t.append("line").attr("class","dial_hand").attr("x2",.7*e.dial_radius).transition().duration(this.current_angle/360*5e3).attrTween("transform",function(){var a=d3.interpolate(0,e.current_angle);return function(t){return"rotate("+a(t)+")"}});t=t.selectAll(".dial_ticks").data(e.dial_face_data).enter().append("g").attr("transform",function(t){return"rotate("+t.angle+") translate("+-e.dial_radius+", 0) "});return t.append("line").attr("x2",7),t.append("text").style("text-anchor","middle").attr("class","dial_tick_labels").attr("dy",".35em").attr("transform",function(t){return t.angle<270&&t.angle,"translate(20,0) rotate(-90) "}).text(function(t){return d3.format(",.0f")(100*t.value)}),e.chart_area.append("text").attr("class","dial_counter").attr("transform","translate(250,"+(e.height/2.5+7)+")").text("").style("text-anchor","end").transition().delay(this.current_angle/360*5e3).text("0%"),e},Dial.prototype.update_dial=function(a,e){var t=this,r=t.processed_data.filter(function(t){return t.group===a})[0].values.filter(function(t){return t.variable===e})[0],n=t.dial_scale(r.value),i=t.current_angle;return t.chart_area.selectAll(".dial_hand").transition().duration(1e3).attrTween("transform",function(){var a=d3.interpolate(i,n);return function(t){return"rotate("+a(t)+")"}}),t.chart_area.selectAll(".dial_counter").transition().delay(1e3).text(d3.format("%")(r.value)),t.current_angle=n,t},Dial.prototype.add_title=function(t){return this.svg.append("text").attr("class","title").text(t).style("text-anchor","middle").attr("transform","translate("+(this.margin.left+this.width/2)+",20)"),this},Dial.prototype.add_subtitle=function(t){return this.svg.append("text").attr("class","subtitle").text(t).style("text-anchor","middle").attr("transform","translate("+(this.margin.left+this.width/2)+",40)"),this},function(t){this.formula=t.replace(/ /g,"");t=this.formula.split("="),t={response:t[0],explanatory:t[1].split("+").map(function(t){var t=t.split("*"),a=parseFloat(t[0]),t=t[1].split("[");return{coef:a,variable:t[0],variable_range:t[1].slice(0,-1).split(",").map(function(t){return parseFloat(t)})}})};console.log(t);d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("basis")});function random_gamma(t,i){var s=d3.random.normal(),o=t-1/3,l=1/Math.sqrt(9*o);return function(){for(;!(r&n);)var t=s(),a=Math.random(),e=Math.pow(1+l*t,3),r=-1/l<t,n=Math.log(a)<.5*Math.pow(t,2)+o-o*e+o*Math.log(e);return o*e/i}}function random_dirichlet(t){var e=t.map(function(t){return random_gamma(t,1)});return function(){var t=e.map(function(t){return t()}),a=d3.sum(t);return t.map(function(t){return t/a})}}var AnimatedDensity=function(t,a,e,r,n,i){this.processed_data=t,GridChart.call(this,a,e,r,n,i)};function animated_density(t,a){var e=[],r=random_gamma(5,1);for(i=0;i<5e3;i++)e.push(r());var n,s,o,e=e.map(function(t){return Math.round(10*t)/10}),l=Array.apply(null,Array(500)).map(Number.prototype.valueOf,0);e=e.map(function(t){return l[10*t]=l[10*t]+1,{value:t,position:l[10*t]}});t=t,a=a,s=(n=e).map(function(t){return t.value}),o=n.map(function(t){return t.position}),s=[create_scale(d3.extent(s),d3.scale.linear()),create_scale([0,d3.max(o)+5],d3.scale.linear())],new AnimatedDensity(n,t,a,["Random Variable with Gamma Distribution","Occurrences"],s).add_svg().add_grid().add_density()}AnimatedDensity.prototype=Object.create(GridChart.prototype),AnimatedDensity.prototype.add_density=function(){var a=this,t=d3.max([a.width/(10*a.x.domain()[1]),a.height/a.y.domain()[1]])+2;a.chart_area.selectAll("rect").data(a.processed_data).enter().append("circle").attr("class","block").attr("r",t).attr("cx",function(t){return a.x(t.value)}).attr("cy",0).attr("opacity",0).transition().duration(2500).delay(function(t,a){return 40*a}).attr("cy",function(t){return a.height-t.position*a.height/a.y.domain()[1]}).attr("opacity",1)};var PolygonMap=function(t,a,e,r){var n=this;margin={top:5,bottom:0,left:5,right:5},GlasseyeChart.call(n,a,e,margin,700),n.processed_data=t,n.tooltip_function=r,n.projection=d3.geo.albers().center([0,55.4]).rotate([4.4,0]).parallels([50,60]).scale(300*n.width/46).translate([n.width/2,n.height/2.4]),n.path=d3.geo.path().projection(n.projection),n.tip=d3.select(n.div).append("div").attr("class","hidden tooltip")},Skey=(PolygonMap.prototype=Object.create(GlasseyeChart.prototype),PolygonMap.prototype.add_map=function(){var e=this;return e.chart_area.selectAll(".map_region").data(e.processed_data).enter().append("path").attr("class",function(t){return"map_region "+t.properties.name.split(" ").join("_")}).attr("d",e.path).on("mouseenter",function(t){e.tooltip_function(t.properties.name);var a=d3.mouse(e.chart_area.node()).map(function(t){return parseInt(t)});e.tip.classed("hidden",!1).attr("style","left:"+a[0]+"px; top:"+ +a[1]+"px").html(t.properties.name)}).on("mouseleave",function(){e.tip.classed("hidden",!0)}),this},PolygonMap.prototype.redraw_map=function(t){var a=this;return d3.select(a.div).selectAll("svg").remove(),a.set_size(),a.projection=d3.geo.albers().center([0,55.4]).rotate([4.4,0]).parallels([50,60]).scale(300*a.width/46).translate([a.width/2,a.height/2.4]),a.path=d3.geo.path().projection(a.projection),a.add_svg().add_map().add_title(a.title,a.subtitle)},function(t,a,e){GlasseyeChart.call(this,a,e,"full_page"===e?{top:5,bottom:5,left:100,right:100}:{top:5,bottom:5,left:50,right:50},300),this.processed_data=t,self.sankeyGenerator=d3.sankey().nodeWidth(15).nodePadding(10).extent([[1,1],[this.width-1,this.height-6]]),self.sankeyData=sankeyGenerator({nodes:this.processed_data.nodes.map(t=>Object.assign({},t)),links:this.processed_data.links.map(t=>Object.assign({},t))})});function skey(t,a,e){build_chart(t,a,e,void 0,function(t){return t},function(t){return t},function(t,a,e){new Skey(t,a,e).add_svg().add_sankey()})}Skey.prototype=Object.create(GlasseyeChart.prototype),Skey.prototype.add_sankey=function(){this.chart_area.append("g").attr("class","links").selectAll("path").data(self.sankeyData.links).enter().append("path").attr("d",d3.sankeyLinkHorizontal()).attr("stroke","steelblue").attr("stroke-width",t=>Math.max(1,t.width)).attr("fill","none").attr("stroke-opacity",.2).on("mouseover",function(){d3.select(this).attr("stroke-opacity",.5)}).on("mouseout",function(){d3.select(this).attr("stroke-opacity",.2)});var t=this.chart_area.append("g").attr("class","nodes").selectAll("g").data(self.sankeyData.nodes).enter().append("g");t.append("rect").attr("x",t=>t.x0).attr("y",t=>t.y0).attr("height",t=>t.y1-t.y0).attr("width",self.sankeyGenerator.nodeWidth()).attr("fill","steelblue").attr("stroke","steelblue"),t.append("text").attr("x",t=>t.x0<this.width/2?t.x1+6:t.x0-6).attr("y",t=>(t.y1+t.y0)/2).attr("dy","0.35em").attr("text-anchor",t=>t.x0<this.width/2?"start":"end").text(t=>t.name)};var BarChart=function(t,a,e){this.margin="full_page"===e?{top:5,bottom:5,left:100,right:100}:{top:5,bottom:5,left:50,right:50},GlasseyeChart.call(this,a,e,this.margin,300),this.processed_data=t,this.xScale=d3.scaleBand().domain(d3.groupSort(this.processed_data,([t])=>-t.value,t=>t.label.toString())).range([this.margin.left,this.width-this.margin.right]).padding(.1),this.yScale=d3.scaleLinear().domain([0,d3.max(this.processed_data,t=>t.value)]).range([this.height-this.margin.bottom,this.margin.top])};function barchart(t,a,e){build_chart(t,a,e,void 0,function(t){return t},function(t){return t},function(t,a,e){new BarChart(t,a,e).add_svg().add_barchart()})}BarChart.prototype=Object.create(GlasseyeChart.prototype),BarChart.prototype.add_barchart=function(){this.chart_area.append("g").attr("fill","steelblue").selectAll().data(this.processed_data).join("rect").attr("x",t=>this.xScale(t.label.toString())).attr("y",t=>this.yScale(t.value)).attr("height",t=>this.yScale(0)-this.yScale(t.value)).attr("width",this.xScale.bandwidth()),this.chart_area.append("g").attr("transform",`translate(0,${this.height-this.margin.bottom})`).call(d3.axisBottom(this.xScale).tickSizeOuter(0)),this.chart_area.append("g").attr("transform",`translate(${this.margin.left},0)`).call(d3.axisLeft(this.yScale).tickFormat(t=>t.valueOf().toFixed())).call(t=>t.select(".domain").remove())};var Pie=function(t,a,e){GlasseyeChart.call(this,a,e,"full_page"===e?{top:5,bottom:5,left:100,right:100}:{top:5,bottom:5,left:50,right:50},300),this.processed_data=t,this.radius=Math.min(this.width,this.height)/2};function piechart(t,a,e,r=!1){build_chart(t,a,e,void 0,function(t){return t},function(t){return t},function(t,a,e){new Pie(t,a,e).add_svg().add_pie(r)})}function donut(t,a,e){piechart(t,a,e,!0)}Pie.prototype=Object.create(GlasseyeChart.prototype),Pie.prototype.add_pie=function(t=!1){color=d3.scaleOrdinal().domain(this.processed_data.map(t=>t.label)).range(d3.schemeCategory10),pie=d3.pie().value(t=>t.value).sort(null),arc=d3.arc().innerRadius(t?.5*this.radius:0).outerRadius(this.radius),(arcs=this.chart_area.selectAll(".arc").data(pie(this.processed_data)).enter().append("g").attr("class","arc")).append("path").attr("d",arc).attr("fill",t=>color(t.data.label)),arcs.append("text").attr("transform",t=>`translate(${arc.centroid(t)})`).attr("text-anchor","middle").text(t=>t.data.label)};var Linechart=function(t,a,e){this.margin="full_page"===e?{top:5,bottom:5,left:100,right:100}:{top:5,bottom:5,left:50,right:50},GlasseyeChart.call(this,a,e,this.margin,300),this.processed_data=t};function linechart(t,a,e){build_chart(t,a,e,void 0,function(t){return t},function(t){return t},function(t,a,e){new Linechart(t,a,e).add_svg().add_linechart()})}Linechart.prototype=Object.create(GlasseyeChart.prototype),Linechart.prototype.add_linechart=function(){x=d3.scaleLinear().domain([d3.min(this.processed_data,t=>t.x),d3.max(this.processed_data,t=>t.x)]).range([0,this.width]),y=d3.scaleLinear().domain([0,d3.max(this.processed_data,t=>t.y)]).range([this.height,0]),line=d3.line().x(t=>x(t.x)).y(t=>y(t.y)),this.chart_area.append("g").attr("transform",`translate(0,${this.height})`).call(d3.axisBottom(x).ticks(6)),this.chart_area.append("g").call(d3.axisLeft(y)),this.chart_area.append("path").datum(this.processed_data).attr("class","line").attr("d",line)};var Force=function(t,a,e){GlasseyeChart.call(this,a,e,"full_page"===e?{top:5,bottom:5,left:100,right:100}:{top:5,bottom:5,left:50,right:50},300),this.processed_data=t,this.force=d3.layout.force().charge(-120).linkDistance(30).size([this.width,this.height]),this.tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t.name})};function force(t,a,e){build_chart(t,a,e,void 0,function(t){return t},function(t){return t},function(t,a,e){new Force(t,a,e).add_svg().add_force()})}Force.prototype=Object.create(GlasseyeChart.prototype),Force.prototype.add_force=function(){var a=d3.scale.category20(),t=(this.chart_area.call(this.tip),this.force.nodes(this.processed_data.nodes).links(this.processed_data.links).start(),this.chart_area.selectAll(".forcelink").data(this.processed_data.links).enter().append("line").attr("class","forcelink").style("stroke-width",function(t){return Math.sqrt(t.value)})),e=this.chart_area.selectAll(".forcenode").data(this.processed_data.nodes).enter().append("circle").attr("class","forcenode").attr("r",8).style("fill",function(t){return a(t.group)}).call(this.force.drag).on("mouseover",this.tip.show).on("mouseout",this.tip.hide);this.force.on("tick",function(){t.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),e.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})})};var Gantt=function(t,a,e){GlasseyeChart.call(this,a,e,"full_page"===e?{top:5,bottom:5,left:100,right:100}:{top:5,bottom:5,left:50,right:50},300),this.processed_data=t,this.xScale=d3.scaleTime().domain([d3.min(this.processed_data,t=>t.start),d3.max(this.processed_data,t=>t.end)]).range([0,this.width]),this.yScale=d3.scaleBand().domain(this.processed_data.map(t=>t.task)).range([0,this.height]).padding(.2),this.xAxis=d3.axisBottom(this.xScale).ticks(d3.timeWeek.every(1)).tickFormat(d3.timeFormat("%d/%m/%Y")),this.yAxis=d3.axisLeft(this.yScale)};function gantt(t,a,e){build_chart(t,a,e,void 0,function(t){},function(t){var a=d3.timeParse("%Y-%m-%d");return t.forEach(t=>{t.start=a(t.start),t.end=a(t.end),t.duration=(t.end-t.start)/864e5}),t},function(t,a,e){new Gantt(t,a,e).add_svg().add_tasks()})}Gantt.prototype=Object.create(GlasseyeChart.prototype),Gantt.prototype.add_tasks=function(){this.chart_area.append("g").attr("class","x-axis").attr("transform",`translate(0,${this.height})`).call(this.xAxis).selectAll("text").attr("transform","rotate(-45)").style("text-anchor","end"),this.chart_area.append("g").attr("class","y-axis").call(this.yAxis),this.chart_area.selectAll(".bar").data(this.processed_data).enter().append("rect").attr("class","bar").attr("x",t=>this.xScale(t.start)).attr("y",t=>this.yScale(t.task)).attr("width",t=>this.xScale(t.end)-this.xScale(t.start)).attr("height",this.yScale.bandwidth())};